<!DOCTYPE html>
<html>
<head>
    <title>选座</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <style type="text/css">
        html,body{
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .title-content{
            background-color: #fff;
            padding: 0.7rem;
        }
        h1,p{margin: 0;padding: 0;}
        ul{padding: 0;margin: 0;}
        li{list-style-type: none;}
        .title{line-height: 1.5rem}
        body{position: relative;background-color: #f5f5f5;}
        .hall-name{

        }
        .hall-name p{
            text-align: center;
            font-size: 13px;
        }
        canvas{

        }
        .text30{font-size: 0.83rem;}
        .text27{font-size: 0.75rem;}
        .ligth-grey{color: #777;}
        .x-content{
            transform-origin:0 0;}
        #seat-container{
            position: relative;
        }
        .seat-index{
            position: absolute;
            top: 30px;
            left: 0;
            z-index: 2;

        }
        .seat-index ul{
            background-color: rgba(0,0,0,.3);
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            transform-origin:0 0;
        }
         .seat-index li{
            padding: 0 3px;
         }
        </style>
    </head>
    <body>
        <div class="title-content">
            <h1 class="text30 title">星球大战：最后的绝地武士</h1>
            <p class="text27 ligth-grey">今天1月8日 13:20 英文3d</p>
        </div>
        <div id="seat-container">
            <div class="hall-name">
                <p class="i-screen">2号UME MAX厅 银幕</p>
            </div>
            <div style="height: 413px;overflow:hidden;border: solid 1px red">
                    <div class="seat-index">
                        <ul class="xseat-rows">
                        </ul>
                    </div>
                    <div class="x-content">
                        <canvas id="drawing" width="2000" height="500"></canvas>
                    </div>
            </div>
        </div>
        <img src="images/seat.png" style="display: none;">
        <img src="images/seat_active.png" style="display: none;">
        <script type="text/javascript">
    //排数
    var row=10;
    //列数
    var column = 20;
    //起始坐标
    var x = 20,y=20;
    var drawing = document.getElementById("drawing");
    var xContent = document.getElementsByClassName('x-content')[0];
    var yContent = document.getElementsByClassName('y-content')[0];
    var index = $(".seat-index ul");
    var startX;
    var endX;
    var diffrenceX=0;
    var hasMovedX=0;
    var translateX=0;

    var startY;
    var endY;
    var diffrenceY=0;
    var hasMovedY=0;
    var translateY=0;
    if(drawing.getContext){
        var width=40*column+10*(column+2);
        var height=40*row+10*(row+2);
        drawing.width=width;
        drawing.height=height;
        index.height(height-50);
        var screenW=document.body.clientWidth;
        var screenH=document.body.clientHeight;
        var scale = screenW/width;
        xContent.style.width=width+"px";
        xContent.style.height=height+"px";
        xContent.style.transform="scale("+scale+","+scale+")";
        index.css("transform","scale("+scale+","+scale+")")
        var context = drawing.getContext("2d");
        context = drawing.getContext('2d')
        var image = document.images[0];
        var imageActive = document.images[1];
        //绘制图像
        for(var i=0;i<row;i++){
            for(var j=0;j<column;j++){
                context.drawImage(image,x,y,40,40); 
                if(j==column/2){
                    context.drawImage(imageActive,x,y,40,40); 
                }
                x+=50;
            }
            index.append("<li>"+(i+1)+"</li>");

            x=20;y+=50;
        }

        
        xContent.addEventListener("click",changeX);
        
        function changeX(){
            xContent.style.transform="scale(1,1)";
            xContent.ontouchstart=function(e){
                startX = e.touches[0].pageX;
                hasMovedX=translateX;//手指再次触摸时，记录上一次已经平移的距离

                startY = e.touches[0].pageY;
                hasMovedY=translateY;//手指再次触摸时，记录上一次已经平移的距离

                xContent.style.transition="none";
            }
            xContent.ontouchmove=function(e){
                endX = e.touches[0].pageX;
                diffrenceX=endX-startX;//手指滑动距离
                translateX=hasMovedX+diffrenceX;//需要平移的距离

                endY = e.touches[0].pageY;
                diffrenceY=endY-startY;//手指滑动距离
                translateY=hasMovedY+diffrenceY;//需要平移的距离
                console.log(translateY);
                xContent.style.transform="translate("+translateX+"px,"+translateY+"px)";
                e.preventDefault();
            }
            xContent.ontouchend=function(e){
                //判断是否移动到了右边界
                if(width+translateX<screenW){
                    translateX=screenW-width;
                    xContent.style.transition="all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms";
                    xContent.style.transform="translate("+translateX+"px,"+translateY+"px)";
                    
                //判断是否移动到了左边界
            }else if(translateX>0){
                translateX=0;
                xContent.style.transition="all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms";
                xContent.style.transform="translate("+translateX+"px,"+translateY+"px)";
                
            }
                //判断是否移动到了下边界
                if(height+translateY<413){
                    translateY=413-height;
                    xContent.style.transition="all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms";
                    xContent.style.transform="translate("+translateX+"px,"+translateY+"px)";
                    
                //判断是否移动到了上边界
            }else if(translateY>0){
                translateY=0;
                xContent.style.transition="all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms";
                xContent.style.transform="translate("+translateX+"px,"+translateY+"px)";
                
            }


        }

    }





    
}


</script>
</body>
</html>