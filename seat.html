<!DOCTYPE html>
<html>
<head>
    <title>选座</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">

    <script src="js/jquery-1.9.1.min.js"></script>
    <style type="text/css">
        html,body{
            width: 100%;
            height: 100%;
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        .title-content{
            background-color: #fff;
            padding: 0.7rem;
            z-index: 3;
            position: relative;
        }
        h1,p{margin: 0;padding: 0;}
        ul{padding: 0;margin: 0;}
        li{list-style-type: none;}
        .title{line-height: 1.5rem}
        body{position: relative;background-color: #f5f5f5;}
        .hall-name{

        }
        .hall-name p{
            text-align: center;
            font-size: 13px;
        }
        canvas{

        }
        .text30{font-size: 0.83rem;}
        .text27{font-size: 0.75rem;}
        .ligth-grey{color: #777;}
        .x-content{
            transform-origin:0 0;}
            #seat-container{
                position: relative;
 
                overflow: hidden;
            }
            .seat-index{
                position: absolute;
                left: 0;
                z-index: 2;
                transform-origin:0 0;



            }
            .seat-index ul{
                background-color: rgba(0,0,0,.3);
                color: #fff;
                display: flex;
                flex-direction: column;
                border-radius: 50px;
                padding-top:25px;
            }
            .seat-index li{
                height: 40px;
                margin:5px;
            }
            .flex-row{
                display: flex;
            }
            .recomment-wrap{
                background-color: #fff;
            }
        </style>
    </head>
    <body>
        <div class="title-content">
            <h1 class="text30 title" onPointerdown="alert(1)">星球大战：最后的绝地武士</h1>
            <p class="text27 ligth-grey">今天1月8日 13:20 英文3d</p>
        </div>
        <div id="seat-container">
            <div class="hall-name">
                <p class="i-screen">2号UME MAX厅 银幕</p>
            </div>
            <div style="height: 413px;overflow:hidden;">
                <div class="seat-index">
                    <ul class="xseat-rows">
                    </ul>
                </div>
                <div class="x-content canvas-container">
                    <canvas id="drawing" width="2000" height="500"></canvas>
                </div>
            </div>
        </div>
        <div class="recomment-wrap flex-row">
                <div class="recommend-title">推荐座位</div>
                <ul class="recommend-list flex-row">                                         
                 <li class="recommend-item ticket-item " data-key="1"><span>1人</span></li> 
                 <li class="recommend-item ticket-item " data-key="2"><span>2人</span></li>
                 <li class="recommend-item ticket-item " data-key="3"><span>3人</span></li> 
                 <li class="recommend-item ticket-item " data-key="4"><span>4人</span></li>
                </ul>
            </div>
        <img src="images/seat.png" style="display: none;">
        <img src="images/seat_active.png" style="display: none;">
        <img src="images/seat_checked.png" style="display: none;">
        <script type="text/javascript">

        $(function(){
            //排数
    var row=13;
    //列数
    var column = 10;
    //图形起始坐标
    var x = 20,y=20;
    //图形相对于屏幕的y坐标

    var drawing = document.getElementById("drawing");
    var xContent = $(".x-content");
    var index = $(".seat-index");

    var drawStartY = xContent.offset().top+y/2;
    var scale;
    var isScale=false;
    var downTime,upTime,upX,upY;
    var activeR;
    var activeC;
    //以下用于计算平移距离
    var startX;
    var endX;
    var diffrenceX=0;
    var hasMovedX=0;
    var translateX=0;
    var startY;
    var endY;
    var diffrenceY=0;
    var hasMovedY=0;
    var translateY=0;

    
    


    if(drawing.getContext){
        var width=40*column+10*(column+2);
        var height=40*row+10*(row+2);
        drawing.width=width;
        drawing.height=height;
        index.height(height);
        var screenW=document.body.clientWidth;
        var screenH=document.body.clientHeight;
        scale = 413/height;
        var toCenter = screenW/2-width*scale/2;
        translateX=toCenter;
        console.log(toCenter);
        xContent.css({
            width: width+"px",
            height: height+"px",
            transform: "translateX("+toCenter+"px) scale("+scale+","+scale+")"
        });
        index.css("transform","scale("+scale+","+scale+")")
        var context = drawing.getContext("2d");
        context = drawing.getContext('2d')
        var image = document.images[0];
        var imageActive = document.images[1];
        var imageChecked = document.images[2];
        //绘制图像
        for(var i=0;i<row;i++){
            for(var j=0;j<column;j++){
                context.drawImage(image,x,y,40,40); 
                if(j==column/2){
                    context.drawImage(imageActive,x,y,40,40); 
                }
                x+=50;
            }
            index.find("ul").append("<li>"+(i+1)+"</li>");

            x=20;y+=50;
        }
        y=20;

        

            //touch开始
            xContent.bind("touchstart",function(e){
                downTime = new Date().getTime();

                startX = e.originalEvent.targetTouches[0].pageX;
                hasMovedX=translateX;//手指再次触摸时，记录上一次已经平移的距离
                startY = e.originalEvent.targetTouches[0].pageY;
                hasMovedY=translateY;//手指再次触摸时，记录上一次已经平移的距离
                xContent.css("transition","none");
                index.css("transition","none");
            })



            //touch移动
            xContent.bind("touchmove",function(e){
                endX = e.originalEvent.targetTouches[0].pageX;
                diffrenceX=endX-startX;//手指滑动距离
                translateX=hasMovedX+diffrenceX;//需要平移的距离

                endY = e.originalEvent.targetTouches[0].pageY;
                diffrenceY=endY-startY;//手指滑动距离
                translateY=hasMovedY+diffrenceY;//需要平移的距离
                xContent.css("transform","translate("+translateX+"px,"+translateY+"px) scale("+scale+","+scale+")");
                index.css("transform","translateY("+translateY+"px) scale("+scale+","+scale+")");
                e.preventDefault();
            });


            //touch结束

            xContent.bind("touchend",function(e){
                upTime = new Date().getTime();//用来判断是点击还是拖拉
                var isInX = (startX-hasMovedX-x)%(50*scale)>=0&&(startX-hasMovedX-x)%(50*scale)<=40;//x方向判断是否落在图形内
                if(upTime-downTime<150){
                    if(isInX){
                    //除法取整数,乘以scale是为了在缩放时，也能正确定位到图形
                    activeR=parseInt((startX-hasMovedX-x*scale)/(50*scale));//x方向第几个
                    activeC=parseInt((startY-hasMovedY-drawStartY)/(50*scale));//y方向第几个
                    var a=activeR*(50*scale)+x*scale;var b=activeC*(50*scale)+y*scale;
                    context.clearRect(a/scale,b/scale,40,40);
                    context.drawImage(imageChecked,a/scale,b/scale,40,40);
                    scale=1;
                    xContent.css("transform","translate("+translateX+"px,"+translateY+"px) scale(1,1)");
                    index.css("transform","translateY("+translateY+"px) scale(1,1)");

                }
            }
                //判断是否移动到了右边界
                if(width+translateX<screenW){
                    translateX=screenW-width;
                    xContent.css({
                        transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                        transform: "translate("+translateX+"px,"+translateY+"px) scale("+scale+","+scale+")"
                    });
                    
                //判断是否移动到了左边界
            }else if(translateX>0){
                translateX=0;
                xContent.css({
                    transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                    transform: "translate("+translateX+"px,"+translateY+"px) scale("+scale+","+scale+")"
                });
                
            }
                //判断是否移动到了下边界
                if(height+translateY<413){
                    translateY=413-height;
                    xContent.css({
                        transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                        transform: "translate("+translateX+"px,"+translateY+"px) scale("+scale+","+scale+")"
                    });
                    index.css({
                        transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                        transform: "translateY("+translateY+"px) scale("+scale+","+scale+")"
                    });
                    
                //判断是否移动到了上边界
            }else if(translateY>0){
                translateY=0;
                xContent.css({
                    transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                    transform: "translate("+translateX+"px,"+translateY+"px) scale("+scale+","+scale+")"
                });
                index.css({
                    transition: "all 500ms cubic-bezier(0.25,0.1,0.25,0.1) 0ms",
                    transform: "translateY("+translateY+"px) scale("+scale+","+scale+")"
                });
                
            }


        })








        }

        })
    

    </script>
</body>
</html>